{"version":3,"sources":["webpack:///./node_modules/gatsby-source-prismic-graphql/components/PreviewPage.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_toConsumableArray2","_regenerator","_asyncToGenerator2","_classCallCheck2","_createClass2","_possibleConstructorReturn2","_getPrototypeOf3","_assertThisInitialized2","_inherits2","_defineProperty2","_react","_prismicJavascript","_utils","_parseQueryString","_pathToRegexp","PreviewPage","_React$Component","_getPrototypeOf2","_this","this","_len","arguments","length","args","Array","_key","call","apply","concat","_ref","mark","_callee","doc","link","urlWithQueryString","exists","wrap","_context","prev","next","window","location","abrupt","linkResolver","config","pages","map","page","keys","match","exec","slice","reduce","acc","i","str","indexOf","name","path","find","n","fetch","then","res","status","t0","sent","stop","_x","_preview","key","preview","_callee2","qs","token","experiment","documentId","now","api","runningVariations","matchedVariation","cookies","_doc","_preview2","_context2","props","parseQueryString","String","search","substr","get","Date","setHours","getHours","getApi","repositoryName","previewSession","document","cookie","previewCookie","toUTCString","redirect","getByID","experiments","running","data","variations","variation","label","toLowerCase","replace","experimentCookie","ref","getCookies","has","prismic","options","Component"],"mappings":"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","file":"component---node-modules-gatsby-source-prismic-graphql-components-preview-page-js-074bf18d5b8af77055ce.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf3 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _prismicJavascript = _interopRequireDefault(require(\"prismic-javascript\"));\n\nvar _utils = require(\"../utils\");\n\nvar _parseQueryString = require(\"../utils/parseQueryString\");\n\nvar _pathToRegexp = _interopRequireDefault(require(\"path-to-regexp\"));\n\nvar PreviewPage =\n/*#__PURE__*/\nfunction (_React$Component) {\n  (0, _inherits2.default)(PreviewPage, _React$Component);\n\n  function PreviewPage() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    (0, _classCallCheck2.default)(this, PreviewPage);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(PreviewPage)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"redirect\",\n    /*#__PURE__*/\n    function () {\n      var _ref = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee(doc) {\n        var link, urlWithQueryString, exists;\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (doc) {\n                  _context.next = 3;\n                  break;\n                }\n\n                window.location = '/';\n                return _context.abrupt(\"return\");\n\n              case 3:\n                link = (0, _utils.linkResolver)(doc);\n                urlWithQueryString = (_this.config.pages || []).map(function (page) {\n                  var keys = [];\n                  var re = (0, _pathToRegexp.default)(page.match, keys);\n                  var match = re.exec(link);\n\n                  var delimiter = function delimiter(str) {\n                    return str.indexOf('?') === -1 ? '?' : '&';\n                  };\n\n                  if (match) {\n                    return match.slice(1).reduce(function (acc, value, i) {\n                      return acc + (keys[i] ? \"\".concat(delimiter(acc)).concat(keys[i].name, \"=\").concat(value) : value);\n                    }, page.path);\n                  }\n\n                  return null;\n                }).find(function (n) {\n                  return !!n;\n                });\n                _context.next = 7;\n                return fetch(link).then(function (res) {\n                  return res.status;\n                });\n\n              case 7:\n                _context.t0 = _context.sent;\n                exists = _context.t0 === 200;\n\n                if (!exists && urlWithQueryString) {\n                  window.location = urlWithQueryString;\n                } else {\n                  window.location = link;\n                }\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    return _this;\n  }\n\n  (0, _createClass2.default)(PreviewPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.preview();\n    }\n  }, {\n    key: \"preview\",\n    value: function () {\n      var _preview = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee2() {\n        var location, qs, token, experiment, documentId, now, api, doc, runningVariations, matchedVariation, cookies, _doc, _preview2;\n\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                location = this.props.location;\n                qs = (0, _parseQueryString.parseQueryString)(String(location.search).substr(1));\n                token = qs.get('token');\n                experiment = qs.get('experiment');\n                documentId = qs.get('documentId'); // Expiration date of cookie\n\n                now = new Date();\n                now.setHours(now.getHours() + 1);\n                _context2.next = 9;\n                return _prismicJavascript.default.getApi(\"https://\".concat(this.config.repositoryName, \".cdn.prismic.io/api/v2\"));\n\n              case 9:\n                api = _context2.sent;\n\n                if (!token) {\n                  _context2.next = 22;\n                  break;\n                }\n\n                _context2.next = 13;\n                return api.previewSession(token, _utils.linkResolver, '/');\n\n              case 13:\n                document.cookie = \"\".concat(_prismicJavascript.default.previewCookie, \"=\").concat(token, \"; expires=\").concat(now.toUTCString(), \"; path=/\");\n\n                if (documentId) {\n                  _context2.next = 16;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", this.redirect());\n\n              case 16:\n                _context2.next = 18;\n                return api.getByID(documentId);\n\n              case 18:\n                doc = _context2.sent;\n                return _context2.abrupt(\"return\", this.redirect(doc));\n\n              case 22:\n                if (!experiment) {\n                  _context2.next = 28;\n                  break;\n                }\n\n                runningVariations = [];\n\n                if (api.experiments.running && api.experiments.running.length) {\n                  runningVariations.concat.apply(runningVariations, (0, _toConsumableArray2.default)(api.experiments.running.map(function (experiment) {\n                    return experiment.data.variations;\n                  })));\n                }\n\n                if (experiment && runningVariations.length) {\n                  matchedVariation = runningVariations.find(function (variation) {\n                    return variation.label.toLowerCase().replace(' ', '-') === experiment;\n                  });\n\n                  if (matchedVariation) {\n                    document.cookie = \"\".concat(_prismicJavascript.default.experimentCookie, \"=\").concat(matchedVariation.ref, \"; expires=\").concat(now.toUTCString(), \"; path=/\");\n                    this.redirect();\n                  }\n                }\n\n                _context2.next = 35;\n                break;\n\n              case 28:\n                if (!documentId) {\n                  _context2.next = 35;\n                  break;\n                }\n\n                cookies = (0, _utils.getCookies)();\n                _context2.next = 32;\n                return api.getByID(documentId);\n\n              case 32:\n                _doc = _context2.sent;\n                _preview2 = cookies.has(_prismicJavascript.default.previewCookie) || cookies.has(_prismicJavascript.default.experimentCookie);\n                this.redirect(_preview2 && _doc);\n\n              case 35:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function preview() {\n        return _preview.apply(this, arguments);\n      }\n\n      return preview;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      return null;\n    }\n  }, {\n    key: \"config\",\n    get: function get() {\n      return this.props.prismic.options;\n    }\n  }]);\n  return PreviewPage;\n}(_react.default.Component);\n\nexports.default = PreviewPage;"],"sourceRoot":""}